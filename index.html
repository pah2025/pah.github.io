<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PAH Circle Animation</title>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <style>
    body {
      margin: 0;
      background: #eef2f7;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      color: #333;
    }
    h1 {
      margin-bottom: 10px;
    }
    #viz-container {
      background: white;
      width: 800px;
      max-width: 90%;
      border-radius: 15px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.15);
      padding: 20px;
      text-align: center;
    }
    #viz {
      width: 100%;
      height: 600px;
    }
    .btn {
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 14px;
      font-size: 14px;
      cursor: pointer;
      margin: 10px 0;
    }
    .btn:hover {
      background: #0d47a1;
    }
    .info {
      background: #e3f2fd;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      min-height: 30px;
    }
    /* Circle ring behind each prototype */
    .ring {
      transition: transform 0.3s;
      cursor: pointer;
    }
    .ring:hover {
      transform: scale(1.1);
    }
    /* CIFAR images */
    .proto-img {
      pointer-events: none; /* so clicks go to ring group, not the image */
    }
  </style>
</head>
<body>

<h1>Interactive Circle Animation (PAH Prototypes)</h1>

<div id="viz-container">
  <svg id="viz"></svg>
  <button class="btn" id="nextTaskBtn">Train Next Task</button>
  <div class="info" id="infoBox">Click a prototype ring for details.</div>
</div>

<script>
  // ====== Setup SVG & Basic Vars ======
  const width = 800;
  const height = 600;
  const svg = d3.select('#viz')
    .attr('viewBox', [0, 0, width, height]);

  // We'll keep an array of image objects (CIFAR-ish)
  // Each object has: url, label. We'll place them in a circle layout.
  const prototypes = [
    { url: 'https://www.cs.toronto.edu/~kriz/cifar-10-sample/dog4.png',   label: 'Proto: Dog' },
    { url: 'https://www.cs.toronto.edu/~kriz/cifar-10-sample/airplane4.png', label: 'Proto: Airplane' },
    { url: 'https://www.cs.toronto.edu/~kriz/cifar-10-sample/cat3.png',  label: 'Proto: Cat' },
    { url: 'https://www.cs.toronto.edu/~kriz/cifar-10-sample/deer4.png', label: 'Proto: Deer' },
    { url: 'https://www.cs.toronto.edu/~kriz/cifar-10-sample/ship4.png', label: 'Proto: Ship' },
    { url: 'https://www.cs.toronto.edu/~kriz/cifar-10-sample/frog4.png', label: 'Proto: Frog' },
  ];

  let taskNumber = 1;

  // ====== Color scale for ring backgrounds ======
  const colorScale = d3.scaleOrdinal(d3.schemeSet2);

  // ====== Setup Groups for each prototype (circle ring + image) ======
  // We'll create a group <g> for each prototype and store references for transitions.
  // Circle ring behind each image, then the image on top.
  // We'll place them in a radial layout.

  // Create a container group for all prototypes
  const protoG = svg.append('g').attr('class', 'all-prototypes');

  // For convenience, create an array of groups
  const ringGroups = protoG.selectAll('g.ringgroup')
    .data(prototypes)
    .enter()
    .append('g')
    .attr('class', 'ringgroup');

  // Now each group has a background ring (circle)
  ringGroups.append('circle')
    .attr('class', 'ring')
    .attr('r', 40)
    .attr('fill', (d,i) => colorScale(i))
    .attr('cx', width/2)
    .attr('cy', height/2)
    .attr('opacity', 0.8)
    .on('click', function(e, d) {
      // Show info about the clicked prototype
      d3.select('#infoBox')
        .text(`Task ${taskNumber}: ${d.label} triggered dynamic classifier weights!`);
    });

  // Then we place the image on top of that circle
  ringGroups.append('svg:image')
    .attr('class', 'proto-img')
    .attr('width', 50)
    .attr('height', 50)
    .attr('xlink:href', d => d.url)
    .attr('x', width/2 - 25)
    .attr('y', height/2 - 25);

  // ====== Radial Layout Calculation ======
  function radialLayout(index) {
    // We'll randomly shift radius and angle each time for visual excitement
    const baseRadius = 150 + 30*index; // expand outward each task
    const angleOffset = Math.random() * Math.PI * 2;

    // Return array of positions for each prototype in a circle
    return prototypes.map((p, i) => {
      const angle = angleOffset + i * (2 * Math.PI / prototypes.length);
      const x = width/2 + baseRadius * Math.cos(angle);
      const y = height/2 + baseRadius * Math.sin(angle);
      return [x, y];
    });
  }

  // ====== Main Render Function ======
  function render(taskIndex) {
    // We'll get new x,y for each prototype
    const positions = radialLayout(taskIndex);

    ringGroups.each(function(d, i) {
      // For group i, the new position
      const [nx, ny] = positions[i];
      // Transition the ring
      d3.select(this).select('circle')
        .transition().duration(1000)
        .attr('cx', nx)
        .attr('cy', ny)
        .attr('fill', () => colorScale(Math.floor(Math.random()*9))); // random color each time
      // Transition the image
      d3.select(this).select('image')
        .transition().duration(1000)
        .attr('x', nx - 25)
        .attr('y', ny - 25);
    });
  }

  // Initial layout
  render(0);

  // ====== Button for next task ======
  d3.select('#nextTaskBtn').on('click', () => {
    taskNumber++;
    render(taskNumber);
    d3.select('#infoBox')
      .text(`Training on Task ${taskNumber} - prototypes are repositioning and recoloring!`);
  });
</script>

</body>
</html>
